#
# CDDL HEADER START
#
# The contents of this file are subject to the terms of the
# Common Development and Distribution License (the "License").
# You may not use this file except in compliance with the License.
#
# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
# or http://www.opensolaris.org/os/licensing.
# See the License for the specific language governing permissions
# and limitations under the License.
#
# When distributing Covered Code, include this CDDL HEADER in each
# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
# If applicable, add the following below this CDDL HEADER, with the
# fields enclosed by brackets "[]" replaced with your own identifying
# information: Portions Copyright [yyyy] [name of copyright owner]
#
# CDDL HEADER END
#

#
# Copyright (c) 2009, 2023, Oracle and/or its affiliates.
#

BUILD_BITS =		NO_ARCH
include ../../../../make-rules/shared-macros.mk
COMPONENT_BUGDB=	x11/font

COMPONENT_NAME=		font-adobe-100dpi
COMPONENT_VERSION=	1.0.4
COMPONENT_ARCHIVE=	$(COMPONENT_SRC).tar.xz
COMPONENT_ARCHIVE_HASH=	\
	sha256:b67aff445e056328d53f9732d39884f55dd8d303fc25af3dbba33a8ba35a9ccf
COMPONENT_ANITYA_ID=	17197
COMPONENT_BAID=		139262

COMPONENT_NAME_1=	font-adobe-75dpi
COMPONENT_VERSION_1=	1.0.4
COMPONENT_ARCHIVE_HASH_1=	\
	sha256:1281a62dbeded169e495cae1a5b487e1f336f2b4d971d92911c59c103999b911
COMPONENT_ANITYA_ID_1=	17198
COMPONENT_BAID_1=	139263

COMPONENT_NAME_2=	font-adobe-utopia-100dpi
COMPONENT_VERSION_2=	1.0.5
COMPONENT_ARCHIVE_HASH_2=	\
	sha256:fb84ec297a906973548ca59b7c6daeaad21244bec5d3fb1e7c93df5ef43b024b
COMPONENT_ANITYA_ID_2=	17199
COMPONENT_BAID_2=	139264

COMPONENT_NAME_3=	font-adobe-utopia-75dpi
COMPONENT_VERSION_3=	1.0.5
COMPONENT_ARCHIVE_HASH_3=	\
	sha256:a726245932d0724fa0c538c992811d63d597e5f53928f4048e9caf5623797760
COMPONENT_ANITYA_ID_3=	17200
COMPONENT_BAID_3=	139265

COMPONENT_NAME_4=	font-adobe-utopia-type1
COMPONENT_VERSION_4=	1.0.5
COMPONENT_ARCHIVE_HASH_4=	\
	sha256:4cb280bc47693b07c5e00fd0e5ad5721aabebc0548c3f06774e5cc3cbcf75697
COMPONENT_ANITYA_ID_4=	17201
COMPONENT_BAID_4=	139266

COMPONENT_NAME_5=	font-alias
COMPONENT_VERSION_5=	1.0.5
COMPONENT_ARCHIVE_HASH_5=	\
	sha256:9f89e217bb73e0e3636a0a493fbf8b7c995156e0c53d9a0476d201b67c2d6b6e
COMPONENT_ANITYA_ID_5=	15059
COMPONENT_BAID_5=	139267

COMPONENT_NAME_6=	font-arabic-misc
COMPONENT_VERSION_6=	1.0.4
COMPONENT_ARCHIVE_HASH_6=	\
	sha256:46ffe61b52c78a1d2dca70ff20a9f2d84d69744639cab9a085c7a7ee17663467
COMPONENT_ANITYA_ID_6=	15050
COMPONENT_BAID_6=	139268

COMPONENT_NAME_7=	font-bh-100dpi
COMPONENT_VERSION_7=	1.0.4
COMPONENT_ARCHIVE_HASH_7=	\
	sha256:fd8f5efe8491faabdd2744808d3d4eafdae5c83e617017c7fddd2716d049ab1e
COMPONENT_ANITYA_ID_7=	17202
COMPONENT_BAID_7=	139269

COMPONENT_NAME_8=	font-bh-75dpi
COMPONENT_VERSION_8=	1.0.4
COMPONENT_ARCHIVE_HASH_8=	\
	sha256:6026d8c073563dd3cbb4878d0076eed970debabd21423b3b61dd90441b9e7cda
COMPONENT_ANITYA_ID_8=	17203
COMPONENT_BAID_8=	139270

COMPONENT_NAME_9=	font-bh-lucidatypewriter-100dpi
COMPONENT_VERSION_9=	1.0.4
COMPONENT_ARCHIVE_HASH_9=	\
	sha256:76ec09eda4094a29d47b91cf59c3eba229c8f7d1ca6bae2abbb3f925e33de8f2
COMPONENT_ANITYA_ID_9=	17204
COMPONENT_BAID_9=	139271

COMPONENT_NAME_10=	font-bh-lucidatypewriter-75dpi
COMPONENT_VERSION_10=	1.0.4
COMPONENT_ARCHIVE_HASH_10=	\
	sha256:864e2c39ac61f04f693fc2c8aaaed24b298c2cd40283cec12eee459c5635e8f5
COMPONENT_ANITYA_ID_10=	17205
COMPONENT_BAID_10=	139272

COMPONENT_NAME_11=	font-bh-type1
COMPONENT_VERSION_11=	1.0.4
COMPONENT_ARCHIVE_HASH_11=	\
	sha256:19dec3ec06abde6bedd10094579e928be0f0fc3bdb4fbe93f4c69cce406d72a6
COMPONENT_ANITYA_ID_11=	17206
COMPONENT_BAID_11=	139273

COMPONENT_NAME_12=	font-bitstream-100dpi
COMPONENT_VERSION_12=	1.0.4
COMPONENT_ARCHIVE_HASH_12=	\
	sha256:2d1cc682efe4f7ebdf5fbd88961d8ca32b2729968728633dea20a1627690c1a7
COMPONENT_ANITYA_ID_12=	17207
COMPONENT_BAID_12=	139274

COMPONENT_NAME_13=	font-bitstream-75dpi
COMPONENT_VERSION_13=	1.0.4
COMPONENT_ARCHIVE_HASH_13=	\
	sha256:aaeb34d87424a9c2b0cf0e8590704c90cb5b42c6a3b6a0ef9e4676ef773bf826
COMPONENT_ANITYA_ID_13=	17209
COMPONENT_BAID_13=	139275

COMPONENT_NAME_14=	font-bitstream-type1
COMPONENT_VERSION_14=	1.0.4
COMPONENT_ARCHIVE_HASH_14=	\
	sha256:de2f238b4cd72db4228a0ba67829d76a2b7c039e22993d66a722ee385248c628
COMPONENT_ANITYA_ID_14=	17208
COMPONENT_BAID_14=	139276

COMPONENT_NAME_15=	font-cursor-misc
COMPONENT_VERSION_15=	1.0.4
COMPONENT_ARCHIVE_HASH_15=	\
	sha256:25d9c9595013cb8ca08420509993a6434c917e53ca1fec3f63acd45a19d4f982
COMPONENT_ANITYA_ID_15=	17210
COMPONENT_BAID_15=	139277

COMPONENT_NAME_16=	font-dec-misc
COMPONENT_VERSION_16=	1.0.4
COMPONENT_ARCHIVE_HASH_16=	\
	sha256:82d968201d8ff8bec0e51dccd781bb4d4ebf17e11004944279bdc0201e161af7
COMPONENT_ANITYA_ID_16=	17211
COMPONENT_BAID_16=	139278

COMPONENT_NAME_17=	font-ibm-type1
COMPONENT_VERSION_17=	1.0.4
COMPONENT_ARCHIVE_HASH_17=	\
	sha256:c4395e95ba46d40c4ad1737e91cac20c0ab75411329b60db5d99fed92b60ce7f
COMPONENT_ANITYA_ID_17=	17212
COMPONENT_BAID_17=	139279

COMPONENT_NAME_18=	font-micro-misc
COMPONENT_VERSION_18=	1.0.4
COMPONENT_ARCHIVE_HASH_18=	\
	sha256:2ee0b9d6bd7ae849aff1bd82efab44a1b6b368fbb5e11d12ff7f015a3df6f943
COMPONENT_ANITYA_ID_18=	17213
COMPONENT_BAID_18=	139280

COMPONENT_NAME_19=	font-misc-misc
COMPONENT_VERSION_19=	1.1.3
COMPONENT_ARCHIVE_HASH_19=	\
	sha256:79abe361f58bb21ade9f565898e486300ce1cc621d5285bec26e14b6a8618fed
COMPONENT_ANITYA_ID_19=	17214
COMPONENT_BAID_19=	139281

COMPONENT_NAME_20=	font-mutt-misc
COMPONENT_VERSION_20=	1.0.4
COMPONENT_ARCHIVE_HASH_20=	\
	sha256:b12359f4e12c23bcfcb448b918297e975fa91bef5293d88d3c25343cc768bb24
COMPONENT_ANITYA_ID_20=	17215
COMPONENT_BAID_20=	139282

COMPONENT_NAME_21=	font-schumacher-misc
COMPONENT_VERSION_21=	1.1.3
COMPONENT_ARCHIVE_HASH_21=	\
	sha256:8b849f0cdb1e55a34cc3dd8b0fb37443fabbc224d5ba44085569581244a68070
COMPONENT_ANITYA_ID_21=	17216
COMPONENT_BAID_21=	139284

COMPONENT_NAME_22=	font-sony-misc
COMPONENT_VERSION_22=	1.0.4
COMPONENT_ARCHIVE_HASH_22=	\
	sha256:e6b09f823fccb06e0bd0b2062283b6514153323bd8a7486e9c2e3f55ab84946b
COMPONENT_ANITYA_ID_22=	17217
COMPONENT_BAID_22=	139283

COMPONENT_NAME_23=	font-sun-misc
COMPONENT_VERSION_23=	1.0.4
COMPONENT_ARCHIVE_HASH_23=	\
	sha256:dd84dd116d927affa4fa0fa29727b3ecfc0f064238817c0a1e552a0ac384db9f
COMPONENT_ANITYA_ID_23=	17218
COMPONENT_BAID_23=	139285

COMPONENT_NAME_24=	font-xfree86-type1
COMPONENT_VERSION_24=	1.0.5
COMPONENT_ARCHIVE_HASH_24=	\
	sha256:a93c2c788a5ea1c002af7c8662cf9d9821fb1df51b8d2b2c5e0026dfdfea4837
COMPONENT_ANITYA_ID_24=	17219
COMPONENT_BAID_24=	139286

LIST = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24

define extra-target-rules
$(BUILD_DIR)/%_$(1)/.configured: SOURCE_DIR=$$(SOURCE_DIR_$(1))
endef

$(foreach n, $(LIST), \
    $(eval COMPONENT_SRC_$(n) = $(COMPONENT_NAME_$(n))-$(COMPONENT_VERSION_$(n))) \
    $(eval COMPONENT_ARCHIVE_$(n) = $(COMPONENT_SRC_$(n)).tar.xz) \
    $(eval COMPONENT_ARCHIVE_URL_$(n) = $$(COMPONENT_ARCHIVE_URL:$$(COMPONENT_ARCHIVE)=$(COMPONENT_ARCHIVE_$(n)))) \
    $(eval BUILD_DIR_$(n) += $(BUILD_DIR_NO_ARCH)_$(n)) \
    $(eval CONFIGURE_NO_ARCH += $(BUILD_DIR_$(n))/.configured) \
    $(eval BUILD_NO_ARCH_$(n) += $(BUILD_DIR_$(n))/.built) \
    $(eval BUILD_TARGET_LIST += $(BUILD_NO_ARCH_$(n))) \
    $(eval INSTALL_NO_ARCH_$(n) += $(BUILD_DIR_$(n))/.installed) \
    $(eval INSTALL_TARGET_LIST += $(INSTALL_NO_ARCH_$(n))) \
    $(eval $(call extra-target-rules,$(n))) \
)

PRIMARY_BUILD = $(BUILD_NO_ARCH) $(BUILD_TARGET_LIST)
PRIMARY_INSTALL = $(INSTALL_NO_ARCH) $(INSTALL_TARGET_LIST)

BUILD_TARGET += $(PRIMARY_BUILD)
INSTALL_TARGET += $(PRIMARY_INSTALL)

CONFIGURE_OPTIONS += --enable-all-encodings

X11FONTSDIR = $(USRSHAREFONTSDIR)/X11

# Combine Sun aliases and base alias files into fonts.alias.all files
ALIASES_DIRS = 75dpi 100dpi misc Type1
ALIASES_ALL_FILES = \
    $(ALIASES_DIRS:%=$(PROTO_DIR)$(X11FONTSDIR)/%/fonts.alias.all)
INSTALL_TARGET += $(ALIASES_ALL_FILES)

$(PROTO_DIR)$(X11FONTSDIR)/%/fonts.alias.all: $(PRIMARY_INSTALL)
	$(RM) $@
	if [[ -f $(@:.all=) ]] ; then $(MV) $(@:.all=) $@ ; fi
	$(CAT) $(COMPONENT_DIR)/sun-aliases/fonts.alias.$(notdir $(@D)) >> $@

# Reorganize installed fonts into subdirectories used in packages so that
# we can construct the correct fonts.alias & fonts.dir files
INSTALL_TARGET += $(BUILD_DIR)/.postprocessed

# Encodings we split out into separate subdirs for packaging
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-1
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-2
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-3
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-4
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-5
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-7
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-8
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-9
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-10
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-11
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-13
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-14
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-15
ALL_BDF_SUBDIR_ENCODINGS += ISO8859-16

INSTALLALIAS = $(USRLIBDIR)/X11/installalias

$(BUILD_DIR)/.postprocessed: $(PRIMARY_INSTALL) $(ALIASES_ALL_FILES)
	set -e -x ; \
	for d in 75dpi 100dpi misc ; do \
	    for e in $(ALL_BDF_SUBDIR_ENCODINGS) ; do \
		if stat -t $(PROTO_DIR)$(X11FONTSDIR)/$${d}/*-$${e}.pcf \
		    >/dev/null 2>&1 ; then \
		    $(MKDIR) $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e} ; \
		    $(MV) $(PROTO_DIR)$(X11FONTSDIR)/$${d}/*-$${e}.pcf \
			$(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/ ; \
		    $(RM) $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/fonts.dir ; \
		    $(MKFONTDIR) $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/ ; \
		fi ; \
	    done ; \
	    for e in ISO8859-1 ISO8859-8; do \
		if [[ "$${e}" == "ISO8859-8" && "$${d}" != "misc" ]] ; then \
		    continue ; \
		fi ; \
		$(CP) $(PROTO_DIR)$(X11FONTSDIR)/$${d}/fonts.alias.all \
		    $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/ ; \
		(cd $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/ ; \
		    $(INSTALLALIAS) fonts.alias.all .) ; \
		[[ -s $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/fonts.alias ]] || \
		    $(RM) $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/fonts.alias \
		      $(PROTO_DIR)$(X11FONTSDIR)/$${d}-$${e}/fonts.alias.all ; \
	    done ; \
	done ; \
	for d in 75dpi 100dpi misc Type1 ; do \
	    $(RM) $(PROTO_DIR)$(X11FONTSDIR)/$${d}/fonts.dir ; \
	    $(MKFONTDIR) $(PROTO_DIR)$(X11FONTSDIR)/$${d}/ ; \
	    (cd $(PROTO_DIR)$(X11FONTSDIR)/$${d}/ ; \
		$(INSTALLALIAS) fonts.alias.all .) ; \
	done
	$(TOUCH) $@

include $(WS_MAKE_RULES)/x11-component.mk
include $(WS_MAKE_RULES)/font.mk

# Needed at build time for installalias utility
REQUIRED_PACKAGES += x11/library/libxfont2
